<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Booking — YourAirlines</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    :root { --accent:#ff7b00; --bg:#f7f8fb; --card:#fff; --muted:#666; }
    body { background: linear-gradient(135deg,#007bff,#002b80); font-family: Poppins, sans-serif; -webkit-font-smoothing:antialiased; color:#222; margin:24px; }
    .container { max-width: 1000px; margin: 24px auto; background:var(--card); border-radius:12px; overflow:hidden; box-shadow:0 12px 40px rgba(0,0,0,0.18); }
    .header { padding:18px 24px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center; }
    .steps { display:flex; gap:12px; align-items:center; font-size:14px; color:var(--muted); }
    .step { padding:8px 12px; border-radius:999px; background:rgba(0,0,0,0.03); display:flex; gap:8px; align-items:center; }
    .step.active { background:linear-gradient(90deg,var(--accent),#ff9b3a); color:#fff; font-weight:700; }
    main { padding:22px; background: linear-gradient(180deg, #fff, #fafafa); }
    section.step-panel { display:none; }
    section.step-panel.active { display:block; }

    /* Booking Details form */
    .form-grid { display:flex; gap:12px; flex-wrap:wrap; }
    .field { flex:1 1 220px; display:flex; flex-direction:column; gap:6px; }
    input[type="text"], input[type="email"], select, input[type="date"] { padding:10px 12px; border-radius:8px; border:1px solid #ddd; background:#fff; }
    .radio-group { display:flex; gap:12px; align-items:center; }
    .btn { background:var(--accent); color:#fff; padding:10px 16px; border-radius:8px; border:0; cursor:pointer; font-weight:700; }
    .btn.ghost { background:transparent; color:var(--accent); border:1px solid rgba(0,0,0,0.06); }

    /* Flights listing */
    .flights { display:flex; flex-direction:column; gap:12px; margin-top:12px; }
    .flight-card { display:flex; justify-content:space-between; align-items:center; padding:12px; border-radius:10px; background:#fff; box-shadow:0 6px 18px rgba(0,0,0,0.06); border:1px solid rgba(0,0,0,0.03); }
    .flight-info { display:flex; gap:14px; align-items:center; }
    .flight-meta { color:var(--muted); font-size:13px; }
    .flight-right { text-align:right; display:flex; flex-direction:column; gap:6px; align-items:flex-end; }
    .price { font-weight:800; font-size:18px; color:var(--accent); }

    /* Passengers form */
    .passenger { padding:12px; border-radius:8px; background:#fff; border:1px solid #eee; display:flex; gap:12px; align-items:center; }
    .passenger input { width:100%; }

    /* Summary */
    .summary { display:flex; gap:12px; flex-direction:column; }
    .summary .row { display:flex; justify-content:space-between; gap:12px; padding:8px 0; border-bottom:1px dashed #eee; }
    .final { display:flex; justify-content:space-between; align-items:center; margin-top:12px; }

    /* responsive */
    @media (max-width:800px) {
      .form-grid { flex-direction:column; }
      .flight-card { flex-direction:column; align-items:flex-start; }
      .flight-right { width:100%; align-items:flex-start; }
      .header { flex-direction:column; gap:8px; align-items:flex-start; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <strong>YourAirlines</strong> — Booking
      </div>
      <div class="steps" aria-hidden="true">
        <div id="step1badge" class="step active">1. Booking Details</div>
        <div id="step2badge" class="step">2. Flights</div>
        <div id="step3badge" class="step">3. Passenger</div>
        <div id="step4badge" class="step">4. Summary</div>
      </div>
    </div>

    <main>
      <!-- STEP 1: Booking Details -->
      <section id="step1" class="step-panel active">
        <h3>Booking Details</h3>
        <div class="form-grid">
          <div class="field">
            <label>From</label>
            <input id="fromInput" type="text" placeholder="e.g. Manila" />
          </div>
          <div class="field">
            <label>To</label>
            <input id="toInput" type="text" placeholder="e.g. Barcelona" />
          </div>
          <div class="field">
            <label>Flight Type</label>
            <div class="radio-group">
              <label><input type="radio" name="tripType" value="round" checked/> Round Trip</label>
              <label><input type="radio" name="tripType" value="oneway" /> One Way</label>
            </div>
          </div>
          <div class="field" id="departField">
            <label>Depart Date</label>
            <input id="departDate" type="date" />
          </div>
          <div class="field" id="returnField">
            <label>Return Date</label>
            <input id="returnDate" type="date" />
          </div>
          <div class="field">
            <label>Passengers</label>
            <select id="passengersSelect">
              <option value="1">1 passenger</option>
              <option value="2">2 passengers</option>
              <option value="3">3 passengers</option>
              <option value="4">4 passengers</option>
            </select>
          </div>
        </div>

        <div style="margin-top:16px; display:flex; gap:12px;">
          <button id="searchFlightsBtn" class="btn">Search Flights</button>
          <a href="index.html" class="btn ghost" style="text-decoration:none; padding:10px 14px;">Back</a>
        </div>
      </section>

      <!-- STEP 2: Flights -->
      <section id="step2" class="step-panel">
        <h3>Available Flights</h3>
        <div id="flightsContainer" class="flights" aria-live="polite"></div>

        <div style="margin-top:14px; display:flex; gap:12px;">
          <button id="backToDetails" class="btn ghost">Back</button>
          <button id="toPassengerBtn" class="btn" disabled>Continue to Passenger</button>
        </div>
      </section>

      <!-- STEP 3: Passenger -->
      <section id="step3" class="step-panel">
        <h3>Passenger Information</h3>
        <div id="passengersContainer"></div>

        <div style="margin-top:14px; display:flex; gap:12px;">
          <button id="backToFlights" class="btn ghost">Back</button>
          <button id="toSummaryBtn" class="btn">Continue to Summary</button>
        </div>
      </section>

      <!-- STEP 4: Summary -->
      <section id="step4" class="step-panel">
        <h3>Summary</h3>
        <div class="summary" id="summaryContainer"></div>

        <div class="final">
          <div><strong>Total:</strong> <span id="totalPrice">₱0</span></div>
          <div>
            <button id="backToPassenger" class="btn ghost">Back</button>
            <button id="bookNowFinal" class="btn">Book Now</button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    // simple helper
    const $ = id => document.getElementById(id);

    // step handling
    const steps = ['step1','step2','step3','step4'];
    function goTo(stepIndex) {
      steps.forEach((s,i)=>{ $(s).classList.toggle('active', i===stepIndex); document.getElementById('step'+(i+1)+'badge').classList.toggle('active', i===stepIndex); });
    }

    // schedule generator (arrays)
    function buildSchedules({from,to,date,legs=3}) {
      // create 3 default schedules for given date
      const baseTimes = ['06:00','09:10','15:30','20:45'];
      const fares = ['Promo Fare','Standard'];
      const results = [];
      for (let i=0;i<legs;i++){
        const hour = baseTimes[i % baseTimes.length];
        results.push({
          id: `${Math.floor(Math.random()*9000)+100}-${i}`,
          flightNo: ['5J','PX','PR'][i%3] + ' ' + (560+i),
          departDate: date,
          departTime: hour,
          from, to,
          price: Math.floor(15000 + (i*2500)), // sample
          seats: 5 + i*3,
          hours: 6 + i,
          fare: fares[i%2]
        });
      }
      return results;
    }

    // state
    const state = {
      from:'', to:'', tripType:'round', departDate:'', returnDate:'', passengers:1,
      departOptions:[], returnOptions:[],
      selectedDepart:null, selectedReturn:null,
      passengerData: []
    };

    // init UI
    document.addEventListener('DOMContentLoaded', ()=>{
      // trip type toggle
      document.querySelectorAll('input[name="tripType"]').forEach(r=>{
        r.addEventListener('change', (e)=>{
          state.tripType = e.target.value;
          $('returnField').style.display = state.tripType==='round' ? 'block' : 'none';
        });
      });
      // default hide if one-way
      $('returnField').style.display = 'block';

      $('searchFlightsBtn').addEventListener('click', onSearchFlights);
      $('backToDetails').addEventListener('click', ()=> goTo(0));
      $('toPassengerBtn').addEventListener('click', ()=> { buildPassengerForms(); goTo(2); });
      $('backToFlights').addEventListener('click', ()=> goTo(1));
      $('toSummaryBtn').addEventListener('click', onToSummary);
      $('backToPassenger').addEventListener('click', ()=> goTo(2));
      $('bookNowFinal').addEventListener('click', onBookNow);

      // prefill if URL params present (index->booking)
      const params = new URLSearchParams(window.location.search);
      if (params.get('from')) $('fromInput').value = params.get('from');
      if (params.get('to')) $('toInput').value = params.get('to');
      if (params.get('passengers')) $('passengersSelect').value = params.get('passengers');
      // no attempt to parse date range here; user fills dates on this page
    });

    function onSearchFlights(e){
      // validate
      state.from = $('fromInput').value.trim();
      state.to = $('toInput').value.trim();
      state.tripType = document.querySelector('input[name="tripType"]:checked').value;
      state.departDate = $('departDate').value;
      state.returnDate = $('returnDate').value;
      state.passengers = parseInt($('passengersSelect').value,10) || 1;

      if (!state.from || !state.to) { alert('Please enter From and To'); return; }
      if (!state.departDate) { alert('Please choose Depart Date'); return; }
      if (state.tripType === 'round' && !state.returnDate) { alert('Please choose Return Date for round trip'); return; }
      if (state.tripType === 'round' && new Date(state.returnDate) < new Date(state.departDate)) { alert('Return date must be the same or after depart date'); return; }

      // generate options arrays using chosen dates
      state.departOptions = buildSchedules({from:state.from,to:state.to,date:state.departDate, legs:3});
      if (state.tripType === 'round') {
        state.returnOptions = buildSchedules({from:state.to,to:state.from,date:state.returnDate, legs:3});
      } else {
        state.returnOptions = [];
      }

      renderFlights();
      goTo(1);
    }

    function renderFlights(){
      const container = $('flightsContainer'); container.innerHTML = '';
      // Depart options
      const departTitle = document.createElement('div'); departTitle.style.fontWeight='700'; departTitle.textContent = `Depart (${state.departDate})`; container.appendChild(departTitle);
      state.departOptions.forEach(opt=>{
        const card = createFlightCard(opt, false);
        container.appendChild(card);
      });

      if (state.tripType==='round') {
        const returnTitle = document.createElement('div'); returnTitle.style.fontWeight='700'; returnTitle.style.marginTop='8px'; returnTitle.textContent = `Return (${state.returnDate})`; container.appendChild(returnTitle);
        state.returnOptions.forEach(opt=>{
          const card = createFlightCard(opt, true);
          container.appendChild(card);
        });
      }
      // enable continue only when selection ready
      updateContinueButton();
    }

    function createFlightCard(f, isReturn){
      const card = document.createElement('div'); card.className='flight-card';
      const left = document.createElement('div'); left.className='flight-info';
      const times = document.createElement('div'); times.innerHTML = `<div style="font-weight:700">${f.departTime}</div><div class="flight-meta">${f.departDate}</div>`;
      const meta = document.createElement('div'); meta.innerHTML = `<div style="font-weight:700">${f.from} → ${f.to}</div><div class="flight-meta">${f.flightNo} • ${f.hours}h • ${f.fare} • Seats: ${f.seats}</div>`;
      left.appendChild(times); left.appendChild(meta);

      const right = document.createElement('div'); right.className='flight-right';
      const price = document.createElement('div'); price.className='price'; price.textContent = '₱' + f.price.toLocaleString();
      const btn = document.createElement('button'); btn.className='btn'; btn.textContent = 'Select';
      btn.addEventListener('click', ()=> {
        // set selection
        if (isReturn) { state.selectedReturn = f; } else { state.selectedDepart = f; }
        // visually mark chosen
        // remove any selected highlight for same leg
        document.querySelectorAll('.flight-card').forEach(c=> c.style.borderColor = 'rgba(0,0,0,0.03)');
        // highlight selected cards
        // find matching by id
        setTimeout(()=> {
          // highlight specific matching cards
          document.querySelectorAll('.flight-card').forEach(el=>{
            if (el._flightId === state.selectedDepart?._id || el._flightId === state.selectedReturn?._id){} // noop
          });
        },0);
        // simple visual: set outline on this card
        card.style.borderColor = 'rgba(255,123,0,0.6)';
        card.style.boxShadow = '0 12px 28px rgba(255,123,0,0.08)';
        updateContinueButton();
      });

      // attach id for potential styling
      card._flightId = f.id;
      right.appendChild(price); right.appendChild(btn);
      card.appendChild(left); card.appendChild(right);
      return card;
    }

    function updateContinueButton(){
      const btn = $('toPassengerBtn');
      if (state.tripType==='round') {
        btn.disabled = !(state.selectedDepart && state.selectedReturn);
      } else {
        btn.disabled = !state.selectedDepart;
      }
    }

    function buildPassengerForms(){
      const container = $('passengersContainer'); container.innerHTML='';
      state.passengerData = [];
      const n = state.passengers;
      for (let i=0;i<n;i++){
        const div = document.createElement('div'); div.className='passenger';
        div.innerHTML = `<div style="min-width:40px;font-weight:700">P${i+1}</div>
          <div style="flex:1"><input placeholder="Full name" class="pname" required/></div>
          <div style="flex:1"><input placeholder="Email" class="pemail" type="email" required/></div>
          <div style="flex:1"><input placeholder="Phone" class="pphone" required/></div>`;
        container.appendChild(div);
      }
    }

    function onToSummary(){
      // validate passenger forms
      const names = Array.from(document.querySelectorAll('.pname')).map(i=>i.value.trim());
      const emails = Array.from(document.querySelectorAll('.pemail')).map(i=>i.value.trim());
      const phones = Array.from(document.querySelectorAll('.pphone')).map(i=>i.value.trim());
      for (let i=0;i<names.length;i++){
        if (!names[i]) { alert('Enter passenger full name for passenger ' + (i+1)); return; }
        if (!emails[i] || !/^\S+@\S+\.\S+$/.test(emails[i])) { alert('Enter valid email for passenger ' + (i+1)); return; }
      }
      state.passengerData = names.map((n,idx)=>({name:n,email:emails[idx],phone:phones[idx]}));
      renderSummary();
      goTo(3);
    }

    function renderSummary(){
      const container = $('summaryContainer'); container.innerHTML='';
      // flights
      const flightBlock = document.createElement('div'); flightBlock.innerHTML = `<strong>Flight</strong><div style="margin-top:8px">${state.from} → ${state.to}</div>`;
      const dep = document.createElement('div'); dep.style.marginTop='8px';
      dep.innerHTML = `<div><strong>Depart:</strong> ${state.selectedDepart ? state.selectedDepart.departDate + ' ' + state.selectedDepart.departTime : '-'}</div>
                       <div class="flight-meta">Flight No: ${state.selectedDepart?.flightNo || '-' } • Terminal: 1</div>`;
      flightBlock.appendChild(dep);
      if (state.tripType==='round') {
        const ret = document.createElement('div'); ret.style.marginTop='8px';
        ret.innerHTML = `<div><strong>Return:</strong> ${state.selectedReturn ? state.selectedReturn.departDate + ' ' + state.selectedReturn.departTime : '-'}</div>
                         <div class="flight-meta">Flight No: ${state.selectedReturn?.flightNo || '-'} • Terminal: 2</div>`;
        flightBlock.appendChild(ret);
      }
      container.appendChild(flightBlock);

      // passengers
      const pBlock = document.createElement('div'); pBlock.style.marginTop='12px';
      pBlock.innerHTML = `<strong>Passengers (${state.passengerData.length})</strong>`;
      state.passengerData.forEach((p,i)=>{
        const row = document.createElement('div'); row.className='row';
        row.innerHTML = `<div>${i+1}. ${p.name}</div><div>${p.email} • ${p.phone}</div>`;
        pBlock.appendChild(row);
      });
      container.appendChild(pBlock);

      // price calc
      let total = 0;
      if (state.selectedDepart) total += state.selectedDepart.price;
      if (state.selectedReturn) total += state.selectedReturn.price;
      total = total * (state.passengerData.length || 1);
      $('totalPrice').textContent = '₱' + total.toLocaleString();
    }

    function onBookNow(){
      // final validation
      if (!state.selectedDepart) return alert('Choose a departure flight');
      if (state.tripType==='round' && !state.selectedReturn) return alert('Choose a return flight');

      // prepare data
      const bookingRef = 'YA' + Math.floor(100000 + Math.random() * 900000);
      const now = new Date().toISOString();
      const total = ( (state.selectedDepart?.price || 0) + (state.selectedReturn?.price || 0) ) * (state.passengerData.length || 1);

      const payload = {
        ref: bookingRef,
        createdAt: now,
        from: state.from,
        to: state.to,
        tripType: state.tripType,
        depart: state.selectedDepart || null,
        return: state.selectedReturn || null,
        passengers: state.passengerData,
        total
      };

      // save to sessionStorage and navigate to receipt page
      try {
        sessionStorage.setItem('ya_booking_receipt', JSON.stringify(payload));
        window.location.href = 'recipt.html'; // open receipt in same tab
      } catch (err) {
        console.error('Storage error', err);
        alert('Unable to store booking data. Please try again.');
      }
    }
  </script>
</body>
</html>